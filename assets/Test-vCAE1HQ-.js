import{d as k,r as c,v as T,y as q,o as S,c as d,f as r,L as C,M as O,X as R,F as j,n as B,j as P,k as u,_ as $}from"./index-C1EeuRVQ.js";const E={class:"test"},H={class:"input-wrapper"},U={class:"input-container"},W={class:"grid-background"},m=80,z=k({__name:"Test",setup(D){const p=P(),a=c(""),i=c({x:0,y:0}),h=T(()=>({transform:`translate(${i.value.x}px, ${i.value.y}px)`,transition:a.value?"transform 0.3s ease-out":"transform 0.2s ease-out"}));q(a,n=>{n&&(i.value={x:0,y:0})});async function w(){const e=await(await fetch("https://uat-dns-only.funcoin.tw/dunqian/auth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"password",username:"admin@dunqian.com",password:"secret"})})).json();if(e.access_token)return e.access_token;throw new Error(e.message)}async function f(n){var o;const t=await(await fetch(`/dunqian/pms/get_order_data?pms=mastripms&domain=dqhotel&order_number=${n}`)).json();if(t.code==="0"&&((o=t.data)!=null&&o.length))return t.data[0];throw new Error(t.message)}async function v(n,e){const t={pms:"mastripms",domain:"dqhotel",order_number:a.value,email:e.email,name:e.name},s=await(await fetch("https://uat-dns-only.funcoin.tw/dunqian/pre_checkin/pci_url",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)})).json();if(s.code==="0"&&s.url)return s.url;throw new Error(s.message)}const y=n=>{if(a.value)return;const t=n.target.getBoundingClientRect(),o=window.innerWidth,s=window.innerHeight,g=(Math.random()-.5)*300,b=(Math.random()-.5)*300,x=Math.max(-o/2+t.width,Math.min(o/2-t.width,i.value.x+g)),M=Math.max(-s/2+t.height,Math.min(s/2-t.height,i.value.y+b));i.value={x,y:M}},_=async()=>{if(!a.value){alert("一定要輸入訂單號喔！");return}try{const n=await w(),e=await f(a.value),t=await v(n,e);setTimeout(()=>{p.push(`/${t}`)},1e3)}catch(n){alert(n),console.error(n)}},l=c([]);return S(()=>{const n=window.innerWidth,e=window.innerHeight,t=Math.floor(n/m),o=Math.floor(e/m),s=t*o;l.value=Array(s).fill(0)}),(n,e)=>(u(),d("main",E,[r("div",H,[e[1]||(e[1]=r("div",null,[r("label",{for:"order-input",class:"input-label"},"請輸入訂單號碼")],-1)),r("div",U,[C(r("input",{id:"order-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>a.value=t),class:"input-field"},null,512),[[O,a.value]])])]),r("button",{class:"btn primary-btn dodge-button",style:R(h.value),onMouseover:y,onClick:_}," 送出 ",36),r("div",W,[(u(!0),d(j,null,B(l.value,(t,o)=>(u(),d("div",{class:"grid-item",key:o}))),128))])]))}}),L=$(z,[["__scopeId","data-v-59cb428c"]]);export{L as default};
